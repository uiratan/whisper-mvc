---
phase: 01-frontend-audio-upload
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/AudioUploader.tsx
  - src/app/api/upload/route.ts
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can click and select audio file (.wav, .mp3, .ogg)"
    - "Selected file name displays to user"
    - "Upload progress indicator shows during upload"
    - "Loading state displays while processing"
    - "User sees success message after upload"
  artifacts:
    - path: "src/components/AudioUploader.tsx"
      provides: "File upload UI with progress tracking"
      min_lines: 80
      exports: ["AudioUploader"]
    - path: "src/app/api/upload/route.ts"
      provides: "File upload API endpoint"
      exports: ["POST"]
      contains: "formData"
    - path: "src/app/page.tsx"
      provides: "Integration of AudioUploader component"
      contains: "AudioUploader"
  key_links:
    - from: "src/components/AudioUploader.tsx"
      to: "/api/upload"
      via: "fetch POST with FormData"
      pattern: "fetch.*api/upload"
    - from: "src/app/api/upload/route.ts"
      to: "file validation"
      via: "check file type and size"
      pattern: "file\\.type|file\\.size"
---

<objective>
Build complete audio file upload flow with UI component and API endpoint.

Purpose: Enable users to select audio files and upload them with visual progress feedback, fulfilling UPLD-01 and UPLD-02 requirements.
Output: Working upload interface that accepts audio files and provides user feedback.
</objective>

<execution_context>
@/home/uira/.claude/get-shit-done/workflows/execute-plan.md
@/home/uira/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-frontend-audio-upload/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create AudioUploader component with progress tracking</name>
  <files>
    src/components/AudioUploader.tsx
  </files>
  <action>
Create a client component (use 'use client' directive) that handles audio file upload with the following features:

**File Selection:**
- Input element accepting .wav, .mp3, .ogg files
- Display selected file name and size
- Clear/reset functionality

**Upload Progress:**
- Progress bar showing upload percentage
- Use XMLHttpRequest or fetch with progress tracking
- Visual feedback during upload (percentage display)

**Loading States:**
- Disabled state during upload
- Loading spinner/indicator
- Status messages (uploading, processing, success, error)

**Implementation Details:**
- Use React hooks (useState for file, progress, loading states)
- Style with Tailwind CSS (match page design)
- Include file icon/visual element
- Accept formats: audio/wav, audio/mpeg, audio/ogg
- Max file size: 25MB (reasonable for test)
- POST to /api/upload endpoint with FormData

**UI Layout:**
- File drop zone or button to select file
- File info display when selected
- Progress bar (0-100%)
- Upload button (disabled when no file selected)
- Status messages area
- Attractive card design with hover states

Do NOT implement drag-and-drop yet (v2 feature per REQUIREMENTS.md).
  </action>
  <verify>
Check component structure:
```bash
grep -n "use client" src/components/AudioUploader.tsx
grep -n "useState" src/components/AudioUploader.tsx
grep -n "FormData" src/components/AudioUploader.tsx
```

All three patterns should be present.
  </verify>
  <done>
- AudioUploader.tsx created with client component directive
- File input accepts .wav, .mp3, .ogg formats
- Upload progress tracking implemented
- Loading states managed with React hooks
- Styled with Tailwind CSS
- Component ready for integration
  </done>
</task>

<task type="auto">
  <name>Create upload API endpoint</name>
  <files>
    src/app/api/upload/route.ts
  </files>
  <action>
Create Next.js API route handler that accepts file uploads:

**POST Handler:**
- Accept multipart/form-data
- Extract file from FormData
- Validate file type (audio/wav, audio/mpeg, audio/ogg)
- Validate file size (max 25MB)
- Create temporary storage directory if not exists (./uploads or /tmp/whisper-uploads)
- Save file to temporary location with unique filename (timestamp + original name)
- Return JSON response with file info

**Response Format:**
```typescript
{
  success: boolean
  fileName: string
  filePath: string
  fileSize: number
  message: string
}
```

**Error Handling:**
- Invalid file type → 400 with error message
- File too large → 413 with error message
- Upload failure → 500 with error message

**Implementation:**
- Use Next.js 15 App Router route handler syntax
- Import fs from 'fs/promises' for file operations
- Import path for file path handling
- Use crypto.randomUUID() or Date.now() for unique filenames
- Log upload events to console for debugging

**Security:**
- Validate MIME types
- Sanitize filenames
- No arbitrary code execution risk

Note: This endpoint will be extended in Phase 2 to trigger transcription. For now, it just accepts and stores the file.
  </action>
  <verify>
Test API endpoint:
```bash
# Check route file exists and exports POST
grep -n "export async function POST" src/app/api/upload/route.ts

# Verify file validation logic present
grep -n "audio/" src/app/api/upload/route.ts
```

Both checks should pass.
  </verify>
  <done>
- API route created at /api/upload
- POST handler accepts FormData with file
- File type validation implemented (audio formats only)
- File size validation implemented (max 25MB)
- File saved to temporary storage
- JSON response returned with file info
- Error handling for invalid uploads
  </done>
</task>

<task type="auto">
  <name>Integrate AudioUploader into home page</name>
  <files>
    src/app/page.tsx
  </files>
  <action>
Update the home page to integrate the AudioUploader component:

1. Import AudioUploader from '../components/AudioUploader'
2. Replace the placeholder div with the AudioUploader component
3. Ensure proper styling integration (component should fit nicely in the card)

**Code structure:**
```tsx
import AudioUploader from '@/components/AudioUploader'

export default function Home() {
  return (
    <main className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
      <div className="max-w-2xl w-full p-8">
        <h1 className="text-4xl font-bold text-center mb-8 text-gray-800">
          Audio Transcription Test
        </h1>
        <AudioUploader />
      </div>
    </main>
  )
}
```

Keep the page clean and simple. The AudioUploader handles all upload logic.
  </action>
  <verify>
Visit http://localhost:3000 and confirm:
- AudioUploader component renders without errors
- File input is visible and functional
- Clicking file input opens file picker
- Page layout remains centered and styled correctly
- No TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>
- AudioUploader imported and integrated into page.tsx
- Component renders on home page
- Page layout maintained
- No compilation errors
  </done>
</task>

<task type="checkpoint:human-verify">
  <name>Verify audio upload flow</name>
  <action>Checkpoint: Human verification of upload functionality</action>
  <verify>Manual testing by user</verify>
  <done>User confirms upload flow works correctly</done>
  <what-built>
Complete audio upload interface with:
- AudioUploader component with file selection and progress tracking
- Upload API endpoint at /api/upload
- Integrated upload flow on home page
- File validation (type and size)
- Visual feedback (progress bar, loading states, status messages)
  </what-built>
  <how-to-verify>
1. **Start the application:**
   ```bash
   npm run dev
   ```
   Visit http://localhost:3000

2. **Test successful upload:**
   - Click the file input button/area
   - Select an audio file (.mp3, .wav, or .ogg)
   - Verify file name and size display
   - Click upload button
   - Watch progress bar animate from 0% to 100%
   - Confirm success message appears
   - Check uploads directory: file should be saved

3. **Test file validation:**
   - Try uploading a non-audio file (e.g., .txt, .jpg)
   - Should see error message rejecting invalid type
   - Try uploading a large audio file if available (>25MB)
   - Should see error message about file size

4. **Test UI/UX:**
   - Upload button should be disabled when no file selected
   - Interface should be disabled/loading during upload
   - Progress bar should be smooth and visible
   - Status messages should be clear and helpful
   - Design should match page styling (centered, gradient background)

5. **Browser console check:**
   - Open browser dev tools
   - No errors in console
   - Network tab shows successful POST to /api/upload

**Expected behavior:**
- Clean, intuitive upload interface
- Real-time progress feedback
- Clear success/error messages
- Files successfully saved to uploads directory
- All Phase 1 requirements functional (UPLD-01, UPLD-02, DISP-02)
  </how-to-verify>
  <resume-signal>
Type "approved" if upload flow works correctly, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Visual Check:** Visit http://localhost:3000
   - Audio uploader interface displays
   - File input button/area is visible and clickable
   - Design matches page styling

2. **Functional Test:** Test upload flow
   - Click file input, select an audio file (.mp3 or .wav)
   - Verify file name displays
   - Click upload button
   - Progress bar should animate
   - Success message should appear
   - Check browser network tab: POST to /api/upload succeeds (200)

3. **Error Handling:** Test validation
   - Try uploading a non-audio file (should reject)
   - Try uploading a very large file if possible (should reject >25MB)
   - Verify error messages display to user

4. **Code Quality:**
   - TypeScript compilation: `npx tsc --noEmit`
   - No console errors in browser dev tools
   - File saved to uploads directory (check filesystem)
</verification>

<success_criteria>
- User can select audio files through file input
- Selected file information displays (name, size)
- Upload progress indicator shows percentage
- Upload completes successfully and saves file
- Success/error messages display appropriately
- Loading states work correctly (disabled during upload)
- All Phase 1 requirements met: UPLD-01, UPLD-02, DISP-02
</success_criteria>

<output>
After completion, create `.planning/phases/01-frontend-audio-upload/01-02-SUMMARY.md`

**Next Phase:** Phase 2 will add transcription backend (whisper.cpp integration) and results display.
</output>
