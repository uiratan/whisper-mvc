---
phase: 05-output-utilities-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/exportUtils.ts
  - src/components/AudioUploader.tsx
autonomous: true

must_haves:
  truths:
    - "User can copy transcription text to clipboard (plain and timestamped formats)"
    - "User can download transcription as TXT file"
    - "User can download transcription as SRT file"
    - "Copy button shows visual feedback on success"
    - "Exported filenames match the original audio filename"
  artifacts:
    - path: "src/utils/exportUtils.ts"
      provides: "Export utility functions (SRT, TXT generation, download trigger)"
      exports: ["generateSRT", "generateTXT", "downloadFile"]
    - path: "src/components/AudioUploader.tsx"
      provides: "Action buttons for copy and export"
      contains: "Copy.*clipboard|Export.*SRT|Export.*TXT"
  key_links:
    - from: "src/components/AudioUploader.tsx"
      to: "src/utils/exportUtils.ts"
      via: "import and call export functions"
      pattern: "import.*exportUtils|generateSRT|generateTXT|downloadFile"
    - from: "Copy button onClick"
      to: "navigator.clipboard.writeText"
      via: "Clipboard API"
      pattern: "navigator\\.clipboard\\.writeText"
---

<objective>
Enable users to export and copy transcription results in multiple formats.

Purpose: Fulfill EOUT-01 (Copy to clipboard) and EOUT-02 (Export TXT/SRT) requirements by providing convenient action buttons at the top of the results section.

Output: Export utilities and action controls allowing users to copy (plain or timestamped) and download (TXT or SRT) transcription results with filenames matching the original audio file.
</objective>

<execution_context>
@/home/uira/.claude/get-shit-done/workflows/execute-plan.md
@/home/uira/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-output-utilities-ui-polish/05-CONTEXT.md
@src/components/AudioUploader.tsx
</context>

<tasks>

<task type="auto">
  <name>Create export utility functions</name>
  <files>src/utils/exportUtils.ts</files>
  <action>
Create a new utility file with three export functions:

1. **generateSRT(segments, filename)**: Convert segments to SRT format
   - SRT format uses 1-indexed sequence numbers
   - Timestamps in HH:MM:SS,mmm format (note comma before milliseconds)
   - Each entry: sequence number, timestamp range, text, blank line
   - Use the formatTimestamp helper pattern from AudioUploader (MM:SS) but extend to HH:MM:SS,mmm
   - Handle edge cases: empty segments array returns empty string

2. **generateTXT(transcriptionText)**: Return plain text
   - Simply return the full transcription text as-is
   - No formatting or timestamps

3. **downloadFile(content, filename, mimeType)**: Trigger browser download
   - Create Blob with content and mimeType
   - Generate Object URL using URL.createObjectURL
   - Create temporary anchor element with download attribute
   - Programmatically click to trigger download
   - Clean up: revoke Object URL after download

TypeScript interfaces:
- TranscriptionSegment: {start: number, end: number, text: string}
- Function signatures with proper types and JSDoc comments
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compilation.
Manually verify SRT format output matches standard (sequence, HH:MM:SS,mmm --> HH:MM:SS,mmm, text, blank).
  </verify>
  <done>
exportUtils.ts exists with three exported functions (generateSRT, generateTXT, downloadFile) and passes TypeScript type checking.
  </done>
</task>

<task type="auto">
  <name>Add action buttons to transcription results</name>
  <files>src/components/AudioUploader.tsx</files>
  <action>
Modify the transcription results section (currently starts at line 466) to add action buttons at the top per user decision:

1. **Import utilities**: Add `import { generateSRT, generateTXT, downloadFile } from '../utils/exportUtils'`

2. **Add state for copy feedback**:
   - `const [copyMode, setCopyMode] = useState<'text' | 'timestamps' | null>(null)`
   - Use this to show checkmark icon temporarily after copy

3. **Create helper to extract original filename**:
   - `const getBaseFilename = () => selectedFile?.name.replace(/\.[^.]+$/, '') || 'transcription'`
   - Removes extension from original file for export naming

4. **Add action buttons section** right after the "Transcription" heading (before "Full Text"):
   ```tsx
   <div className="flex flex-wrap gap-2 mb-4">
     {/* Copy Text Only */}
     <button onClick={handleCopyText} className="...">
       {copyMode === 'text' ? CheckIcon : CopyIcon}
       Copy Text
     </button>

     {/* Copy With Timestamps */}
     <button onClick={handleCopyWithTimestamps} className="...">
       {copyMode === 'timestamps' ? CheckIcon : CopyIcon}
       Copy + Timestamps
     </button>

     {/* Export TXT */}
     <button onClick={handleExportTXT} className="...">
       {DownloadIcon} Export TXT
     </button>

     {/* Export SRT */}
     <button onClick={handleExportSRT} className="...">
       {DownloadIcon} Export SRT
     </button>
   </div>
   ```

5. **Implement handlers**:
   - `handleCopyText`: Copy `transcription.text` to clipboard, set copyMode to 'text' for 2 seconds
   - `handleCopyWithTimestamps`: Format segments as `[MM:SS] text` lines, copy, set copyMode to 'timestamps'
   - `handleExportTXT`: Call `downloadFile(generateTXT(transcription.text), getBaseFilename() + '.txt', 'text/plain')`
   - `handleExportSRT`: Call `downloadFile(generateSRT(transcription.segments, getBaseFilename()), getBaseFilename() + '.srt', 'text/plain')`
   - Use setTimeout to reset copyMode after 2000ms

6. **Styling**: Use Tailwind classes matching existing button patterns (indigo theme, hover states, responsive text sizes). Use inline SVG icons for Copy, Check, Download.

7. **Preserve existing structure**: Keep Full Text and Segments sections exactly as they are (no changes to lines 471-497).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compilation.
Verify buttons appear at top of results section.
Test copy buttons trigger clipboard API (check browser console for errors).
Test export buttons trigger downloads with correct filenames.
  </verify>
  <done>
Four action buttons appear at the top of the transcription results. Copy buttons show checkmark feedback after click. Export buttons download files with original audio filename as base. TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npx tsc --noEmit`
2. Action buttons are visible and positioned at top of results
3. Copy functionality works for both modes (text only, with timestamps)
4. Copy buttons show temporary checkmark icon feedback
5. Export TXT downloads plain text file
6. Export SRT downloads properly formatted SRT file
7. Exported filenames match original audio filename
8. All buttons have proper hover states and responsive sizing
</verification>

<success_criteria>
- [ ] User can click "Copy Text" to copy clean transcription to clipboard
- [ ] User can click "Copy + Timestamps" to copy formatted text with timestamps
- [ ] Copy buttons show checkmark icon for 2 seconds after successful copy
- [ ] User can click "Export TXT" to download plain text file
- [ ] User can click "Export SRT" to download SRT subtitle file
- [ ] Downloaded filenames use original audio filename as base (e.g., my-recording.srt)
- [ ] SRT format follows standard: sequence number, HH:MM:SS,mmm timestamps, text
- [ ] All buttons are grouped at top of transcription results section
</success_criteria>

<output>
After completion, create `.planning/phases/05-output-utilities-ui-polish/05-01-SUMMARY.md`
</output>
